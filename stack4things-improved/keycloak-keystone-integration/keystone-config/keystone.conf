[DEFAULT]
# Abilita il debug per vedere cosa succede durante il redirect (FONDAMENTALE in fase di test)
debug = true
verbose = true

# Token provider standard
secure_proxy_ssl_header = HTTP_X_FORWARDED_PROTO

# URL Pubblico (come ti raggiunge il browser)
public_endpoint = http://localhost:5000/

[database]
# Connessione al container mariadb definito nel tuo docker-compose
# Struttura: mysql+pymysql://USER:PASSWORD@HOST/DB_NAME
connection = mysql+pymysql://keystone:password_keystone@mariadb/keystone

[token]
# Fernet è il provider standard per i token
provider = fernet
expiration = 3600

[fernet_tokens]
# Chiavi di cifratura (assicurati che la cartella /etc/keystone/fernet-keys sia scrivibile o popolata)
key_repository = /etc/keystone/fernet-keys

[auth]
# QUI È LA MAGIA:
# Aggiungi 'mapped' alla lista. 'mapped' è il plugin che prende i dati da Keycloak
# (via Apache) e li mappa su utenti locali.
methods = external,password,token,oauth1,mapped,openid

# Configurazione specifica per il metodo 'mapped'
#mapped = default

[federation]
# Questo parametro dice a Keystone in quale header HTTP cercare l'Identity Provider (IdP)
# Quando mod_auth_openidc valida il token, inserisce l'URL dell'Issuer (Keycloak) qui.
# Solitamente è HTTP_OIDC_ISS.
remote_id_attribute = HTTP_OIDC_ISS
trusted_dashboard = http://localhost:5000/v3/
sso_callback_template = /etc/keystone/sso_callback.html

#[openid]
#remote_id_attribute = HTTP_OIDC_ISS

[cors]
# Permette le chiamate cross-origin (utile se sviluppi un frontend JS)
allowed_origin = *

[policy]
# File delle policy (default)
driver = sql

# --- SEZIONI OPZIONALI MA UTILI PER EVITARE ERRORI DI LOG ---

[cache]
enabled = false

[assignment]
driver = sql

[role]
driver = sql

[resource]
driver = sql

[identity]
driver = sql
